<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>IIIF Video Nav Demo</title>
    <style href="iiif-tree-component/iiif-tree-component.css"></style>
    <script src="https://unpkg.com/jquery"></script>
    <script src="https://unpkg.com/manifesto.js/dist/client/manifesto.bundle.js"></script>
    <script src="https://unpkg.com/@iiif/manifold/dist/manifold.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsviews/0.9.76/jsviews.min.js"></script>
    <script src="iiif-tree-component/iiif-tree-component.bundle.js"></script>

    <style>
        #app {
            display: flex;
        }

        .tree {
            padding: 2em;
            width: 200px;
        }

        .video {
            flex-grow: 1;
            padding: 2em;
        }

        video {
            width: 600px;
        }
    </style>
</head>
<body>
    <div id="app">  
        <div class="tree">
            <div id="tree" class="iiif-tree-component">
                loading...
            </div>
        </div>
        <div class="video">
            <video src="http://files.blokdust.io/video/story-session1.mp4" controls></video>
        </div>
    </div> 

    <script>
        document.addEventListener('DOMContentLoaded', function (event) {

            var video = document.querySelector('video');
            var manifestUrl = 'iiif-manifest.json';

            Manifold.loadManifest({
                iiifResourceUri: manifestUrl
            }).then(function(helper){    
                
                var treecomponent = new IIIFComponents.TreeComponent({
                    target: document.querySelector('#tree')
                });

                treecomponent.set({
                    helper: helper
                });

                treecomponent.on('treeNodeSelected', function(node) {
                    console.log('selected: ' + node.label);
                    var target = node.data.canvases[0];
                    var time = Manifesto.Utils.getTemporalComponent(target);
                    video.currentTime = time[0];
                    video.play();
                });

            }).catch(function(e) {
                console.error(e);
            });

        });
    </script>
</body>
</html>